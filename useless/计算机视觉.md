# 计算机视觉

----------

## 数学原理

目前计算机视觉模型都主要基于矢量（向量）乘法、矩阵乘法

## 特征检测

某点 领域自相关性

找特征点：

- 这点 和 领域点 差的平方和函数（误差），但是这不符合严格的做法

- 定个阈值x，低于或高于阈值 视为特征点

- 调和均值 + 阈值（是一个比值）

Harris corner 和 DOG 两者互补

3D计算 3维重建

### 异构计算框架

OpenCL CUDA

### 端到端

神经网络可以直接基于图像的原始像素进行分类。

### 老技术流程

研究者通过勤劳与智慧所设计并生成的手工特征。 图像分类研究的主要流程：

1. 获取图像数据集；
2. 使用已有的特征提取函数生成图像的特征；
3. 使用机器学习模型对图像的特征分类；

计算机视觉流程中真正重要的是数据和特征。也就是说，使用较干净的数据集和较有效的特征 甚至比机器学习模型的选择对图像分类结果的影响更大

多层神经网络可能可以学到数据的多级表征，并逐级表示越来越抽象的概念或模式。以图像分类为例，在5.1节中物体边缘检测的例子

结论： 数据 + 特征 > 机器学习模型

机器学习到的特征 可以超越 手工设计的特征

### 图像增广

- 翻转（上下、左右）
- 裁剪
- 颜色变化（亮度、对比度、饱和度、色调）

图像增广通过对训练图像做一系列随机改变，来产生相似但不相同的训练样本，从而扩大训练数据集的规模。

图像增广的另一种解释，随机改变训练样本可以降低模型对某些属性的依赖，从而提高模型的泛化能力。

例如，我们可以对图像进行不同方式的裁剪，使感兴趣的物体出现在不同位置，从而减轻模型对物体出现位置的依赖性。  
我们也可以调整亮度、色彩等因素来降低模型对色彩的敏感度。  
可以说，在当年AlexNet的成功中，图像增广技术功不可没。

随机操作的图像增广通常只应用在训练样本上，而不应用在预测样本上。这是为了预测时能得到一个确定的结果。

## 目标检测（物体检测）

概念：对图像中一个或多个目标，进行识别，进行分类。 应用领域：无人驾驶中识别车辆、行人、道路、障碍、信号指示器；安防领域中检测歹徒、炸弹等

### 边界框（bounding box）

作用：描述目标位置。边界框是一个矩形框，由矩形左上角的(x,y)坐标 与 右下角的(x,y)坐标确定。

### 锚框（对输入图像的一种区域采样方法）(anchor box)

不同的模型对输入图像的采样方法不同。以每个像素为中心生成多个大小和宽高比不同的边界框，这些边界框被称为锚框。

图像上的任意某个像素 以它为中心 一般有n+m-1 个锚框（n、m 表示一组大小比s1 s2...s n; 宽高比r1 r2....r m） 所以 确定某个像素点的所有锚框需要的数据有3个：输入数据像素点位置、一组大小比、一组宽高比

一个确定的锚框需要一对（大小比，宽高比）

#### 交并比

使用生成的锚框 和 目标的真实边界框； 两个框的相交面积 / 两个框的相并面积，值域[0,1] 值越大，相似度越高

#### 标注训练集的锚框

在训练集中，我们将每个锚框视为一个训练样本。为训练目标检测模型，一般将锚框标注为两类标签：

- 锚框所含目标的类别，类别
- 真实边界框相对锚框的偏移量，偏移量（offset）

用锚框来进行目标检测的流程：

在目标检测 训练数据集中，需要提前标注好 真实的边界框位置、类别

1. 生成多个锚框，并为每个锚框预测类别、偏移量
2. 根据预测的偏移量调整锚框位置 得到预测边界框
3. 筛选需要输出的预测边界框

> 1. 怎么筛选最合适的预测边界框？  
     > 遍历预测框 将他们挨个与真实框 做交并比，当比值超过预先设定的值，将这个合适的锚框分配给真实框)



如果一个锚框没有被分配真实边界框，我们只需将该锚框的`类别`设为`背景`。

类别为`背景`的锚框通常被称为`负类锚框`，其余则被称为`正类锚框`。

### 多尺度目标检测

个人理解：即用不同大小的锚框 检测不同大小的目标。小锚框检测小目标，较多；大锚框检测大目标，数量较少

将卷积神经网络的二维数组输出称为特征图。

通过定义特征图的形状 来确定 任一图像上均匀采样的锚框中心（？？？怎么做到的？？

### 单发多框检测（SSD）

### 非极大值抑制（NMS，Non-Maximum Suppression）

该算法作用：找到局部极大值，并筛选（抑制）领域内其余的值。 个人理解：局部最大搜索，局部代表的是一个领域，领域的‘维度’和‘大小’都是可变的参数。  
例如在目标检测中，这个领域就是交并比IoU

这是一个很基础的，简单高效且适用于一维到多维的常见算法。因为特别适合目标检测问题，所以一直沿用至今，随着目标检测研究的深入和要求的提高（eg：原来只想框方框，现在想框多边形框），NMS也延伸出了不少变体。

算法内核：Max(i)大于左边，又大于右边；Max(i)拿着一个一个去比较

使用前提：目标检测模型已经完成了整个前向计算，并给出所有可能的边界框（位置已精修）。

算法输入

算法对一幅图产生的所有的候选框，每个框有坐标与对应的打分（置信度）。

如一组5维数组：

- 每个组表明一个边框，组数是待处理边框数
- 4个数表示框的坐标：X_max，X_min，Y_max，Y_min
- 1个数表示对应分类下的置信度

注意：每次输入的不是一张图所有的边框，而是一张图中属于某个类的所有边框（因此极端情况下，若所有框的都被判断为背景类，则NMS不执行；反之若存在物体类边框，那么有多少类物体则分别执行多少次NMS）。

除此之外还有一个自行设置的参数：阈值 TH。

算法输出 输入的一个子集，同样是一组5维数组，表示筛选后的边界框

算法流程：

1. 将所有的框按类别划分，并剔除背景类，因为无需NMS
2. 对每个`物体类`中的边界框（B_Box），按照分类置信度降序排列。
3. 在某一类中，选择置信度最高的边界框B_Box1，将B_Box1从输入列表中去除，并加入输出列表。
4. 逐个计算B_BOX1与其余B_BOX2的交并比IoU，若IoU(B_BOX1,B_BOX2) > 阈值TH，则在输入去除B_BOX2。
5. 重复步骤3~4，直到输入列表为空，完成一个物体类的遍历。
6. 重复2~5，直到所有物体类的NMS处理完成。
7. 输出列表，算法结束

生成所有像素点的 5组 原始锚框；多尺度检测（均匀生成 稀疏的 不同大小的 原始锚框）

交并比系数 ，除去与标记框IoU过低的 不合适的原始框

非极大值抑制（IoU合适的框中，选取有特色的框（重复度高的框被过滤掉））

## 图像分类

图像分类与目标检测不同，图像分类往往只有一个输出，但目标检测的输出个数却是未知的。